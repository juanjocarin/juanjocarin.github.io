Skip to content
This repository
Search
Pull requests
Issues
Gist
 @juanjocarin
 Unwatch 1
  Star 0
 Fork 0 juanjocarin/Bimbo Private
 Code  Issues 0  Pull requests 0  Wiki  Pulse  Graphs  Settings
Branch: gh-pages Find file Copy pathBimbo/index.html
8b6b406  4 minutes ago
@juanjocarin juanjocarin Create gh-pages branch via GitHub
1 contributor
RawBlameHistory     188 lines (148 sloc)  20.9 KB
<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Bimbo by juanjocarin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Bimbo</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/juanjocarin/Bimbo" class="btn">View on GitHub</a>
      <a href="https://github.com/juanjocarin/Bimbo/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/juanjocarin/Bimbo/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p><strong><em>You're about to get on a plane to Seattle. You want to know if you should bring an umbrella. You call 3 random friends of yours who live there and ask each independently if it's raining. Each of your friends has a 2/3 chance of telling you the truth and a 1/3 chance of messing with you by lying. All 3 friends tell you that "Yes" it is raining. What is the probability that it's actually raining in Seattle?</em></strong></p>

<p>  <a href="https://www.glassdoor.com/Interview/You-re-about-to-get-on-a-plane-to-Seattle-You-want-to-know-if-you-should-bring-an-umbrella-You-call-3-random-friends-of-y-QTN_519262.htm">Facebook interview question posted on Glassdoor</a>.</p>

<p>Most answers posted on the link above are $$\left(\frac{2}{3}\right)^3 = \frac{8}{9}$$, which is the probability that all friends say it rains provided that it actually rains... but we are interested in the opposite, the probability that it rains provided that all friends say it does!</p>

<p>Thus, we need to apply <strong>Bayes' theorem</strong>, which states that the posterior probability (the probability of an hypothesis $$H$$ conditional on a given body of data (evidence, $$E$$) can be calculated as:</p>

<p>$$\begin{aligned} \Pr\left(H \mid E\right) &amp; = \frac{\Pr\left(E \mid H\right) \cdot \Pr\left(H\right)}{\Pr\left(E\right)} \ &amp; = \frac{\Pr\left(E \mid H\right) \cdot \Pr\left(H\right)}{\displaystyle\sum_{h \in \mathbb{H}} \Pr\left(E \mid h\right) \cdot \Pr\left(h\right)} \end{aligned}$$</p>

<p>In this problem:</p>

<p>$$\begin{aligned} H &amp; :  \text{it rains in city }C \ E &amp; : \text{all friends say that it rains} \end{aligned}$$</p>

<p>$$H$$ is a binary event, so:</p>

<p>$$\Pr\left(H \mid E\right) = \frac{\Pr\left(E \mid H\right) \cdot \Pr\left(H\right)}{\Pr\left(E \mid H\right) \cdot \Pr\left(H\right) + \Pr\left(E \mid \bar{H}\right) \cdot \Pr\left(\bar{H}\right)}$$</p>

<p>Let $$p$$ be the probability of rain in $$C$$, and $$q$$ be the probability that one friend tells the truth. Then, if there are $$N$$ friends:</p>

<p>$$\Pr\left(H \mid E\right) = \frac{q^N \cdot p}{q^N \cdot p + (1 - q)^N \cdot (1 - p)}$$</p>

<p>We are told that $$3$$ is the number of friends and that $$q = \frac{2}{3}$$. Hence:</p>

<p>$$\begin{aligned} \Pr\left(H \mid E\right) &amp; = \frac{\left(\frac{2}{3}\right)^3 \cdot p}{\left(\frac{2}{3}\right)^3 \cdot p + \left(\frac{1}{3}\right)^3 \cdot (1 - p)} \ &amp; = \frac{8p}{8p + (1-p)} \ &amp; = \frac{8p}{7p + 1} \end{aligned}$$</p>

<p>The tricky part of the problem is this unknown parameter, $$p$$, which the solution depends on: we may be biased to think that the solution to this kind of problem is fixed, a particular number.</p>

<p>Let's see what the posterior probability would be for a few possible values of the prior probability:</p>

<p>$$prior = \begin{Bmatrix}
0 \ 
1/4 \ 
1/2 \ 
3/4 \ 
1
\end{Bmatrix}
\Rightarrow
posterior = \left{\begin{matrix}
0 \ 
8/11 \ 
8/9 \ 
24/25 \ 
1
\end{matrix}\right.$$</p>

<p>Let's check that the solution above is right, simulating the problem in R (for all possibles values of $$p$$ from $$0$$ to $$1$$, in steps of $$0.05$$):</p>

<div class="highlight highlight-source-r"><pre>library(<span class="pl-smi">dplyr</span>)
set.seed(<span class="pl-c1">12345</span>)
<span class="pl-smi">N</span> <span class="pl-k">&lt;-</span> <span class="pl-c1">5e3</span> <span class="pl-c"># simulations (per value of p)</span>
<span class="pl-smi">q</span> <span class="pl-k">&lt;-</span> <span class="pl-c1">2</span><span class="pl-k">/</span><span class="pl-c1">3</span> <span class="pl-c"># prob of a friend telling the truth</span>
<span class="pl-smi">data</span> <span class="pl-k">&lt;-</span> <span class="pl-k">data.frame</span>(<span class="pl-v">p</span> <span class="pl-k">=</span> rep(seq(<span class="pl-v">from</span> <span class="pl-k">=</span> <span class="pl-c1">0</span>, <span class="pl-v">to</span> <span class="pl-k">=</span> <span class="pl-c1">1</span>, <span class="pl-v">by</span> <span class="pl-k">=</span> <span class="pl-c1">0.05</span>), <span class="pl-v">each</span> <span class="pl-k">=</span> <span class="pl-smi">N</span>))
<span class="pl-smi">data</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">data</span> %<span class="pl-k">&gt;</span>% rowwise() %<span class="pl-k">&gt;</span>% mutate(<span class="pl-v">r</span> <span class="pl-k">=</span> rbinom(<span class="pl-c1">1</span>, <span class="pl-c1">1</span>, <span class="pl-smi">p</span>)) %<span class="pl-k">&gt;</span>% 
  mutate(<span class="pl-v">A</span> <span class="pl-k">=</span> ifelse(<span class="pl-smi">r</span> <span class="pl-k">==</span> <span class="pl-c1">1</span>, rbinom(<span class="pl-c1">1</span>, <span class="pl-c1">1</span>, <span class="pl-smi">q</span>), rbinom(<span class="pl-c1">1</span>, <span class="pl-c1">1</span>, <span class="pl-c1">1</span> <span class="pl-k">-</span> <span class="pl-smi">q</span>)), 
         <span class="pl-v">B</span> <span class="pl-k">=</span> ifelse(<span class="pl-smi">r</span> <span class="pl-k">==</span> <span class="pl-c1">1</span>, rbinom(<span class="pl-c1">1</span>, <span class="pl-c1">1</span>, <span class="pl-smi">q</span>), rbinom(<span class="pl-c1">1</span>, <span class="pl-c1">1</span>, <span class="pl-c1">1</span> <span class="pl-k">-</span> <span class="pl-smi">q</span>)), 
         <span class="pl-v">C</span> <span class="pl-k">=</span> ifelse(<span class="pl-smi">r</span> <span class="pl-k">==</span> <span class="pl-c1">1</span>, rbinom(<span class="pl-c1">1</span>, <span class="pl-c1">1</span>, <span class="pl-smi">q</span>), rbinom(<span class="pl-c1">1</span>, <span class="pl-c1">1</span>, <span class="pl-c1">1</span> <span class="pl-k">-</span> <span class="pl-smi">q</span>))) %<span class="pl-k">&gt;</span>% 
  mutate(<span class="pl-v">ABC</span> <span class="pl-k">=</span> paste0(<span class="pl-smi">A</span>, <span class="pl-smi">B</span>, <span class="pl-smi">C</span>)) %<span class="pl-k">&gt;</span>% select(<span class="pl-smi">p</span>, <span class="pl-smi">r</span>, <span class="pl-smi">ABC</span>) %<span class="pl-k">&gt;</span>% ungroup()
<span class="pl-c"># A, B, C: 1 rains, 0 not</span>
<span class="pl-c"># r: 1 rains, 0 not</span>
<span class="pl-smi">data</span> %<span class="pl-k">&gt;</span>% sample_n(<span class="pl-c1">10</span>) <span class="pl-c"># show 10 of the 21*N rows</span></pre></div>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">Source</span><span class="pl-k">:</span> <span class="pl-smi">local</span> <span class="pl-smi">data</span> <span class="pl-smi">frame</span> [<span class="pl-c1">10</span> <span class="pl-smi">x</span> <span class="pl-c1">3</span>]

       <span class="pl-smi">p</span>     <span class="pl-smi">r</span>   <span class="pl-smi">ABC</span>
   <span class="pl-k">&lt;</span><span class="pl-smi">dbl</span><span class="pl-k">&gt;</span> <span class="pl-k">&lt;</span><span class="pl-smi">int</span><span class="pl-k">&gt;</span> <span class="pl-k">&lt;</span><span class="pl-smi">chr</span><span class="pl-k">&gt;</span>
<span class="pl-c1">1</span>   <span class="pl-c1">0.70</span>     <span class="pl-c1">1</span>   <span class="pl-c1">111</span>
<span class="pl-c1">2</span>   <span class="pl-c1">0.65</span>     <span class="pl-c1">1</span>   <span class="pl-c1">101</span>
<span class="pl-c1">3</span>   <span class="pl-c1">0.85</span>     <span class="pl-c1">1</span>   <span class="pl-c1">111</span>
<span class="pl-c1">4</span>   <span class="pl-c1">0.90</span>     <span class="pl-c1">1</span>   <span class="pl-c1">010</span>
<span class="pl-c1">5</span>   <span class="pl-c1">0.80</span>     <span class="pl-c1">1</span>   <span class="pl-c1">011</span>
<span class="pl-c1">6</span>   <span class="pl-c1">0.75</span>     <span class="pl-c1">1</span>   <span class="pl-c1">111</span>
<span class="pl-c1">7</span>   <span class="pl-c1">0.95</span>     <span class="pl-c1">1</span>   <span class="pl-c1">110</span>
<span class="pl-c1">8</span>   <span class="pl-c1">0.70</span>     <span class="pl-c1">1</span>   <span class="pl-c1">011</span>
<span class="pl-c1">9</span>   <span class="pl-c1">0.55</span>     <span class="pl-c1">1</span>   <span class="pl-c1">101</span>
<span class="pl-c1">10</span>  <span class="pl-c1">0.60</span>     <span class="pl-c1">0</span>   <span class="pl-c1">101</span></pre></div>

<div class="highlight highlight-source-r"><pre><span class="pl-c"># Filter the evidence: all 3 say it rains</span>
<span class="pl-c"># And group by each value of the prior Prob(it rains), p</span>
<span class="pl-smi">data_interest</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">data</span> %<span class="pl-k">&gt;</span>% filter(<span class="pl-smi">ABC</span> <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>111<span class="pl-pds">'</span></span>) %<span class="pl-k">&gt;</span>% group_by(<span class="pl-smi">p</span>) 
<span class="pl-c"># For each value of the prior (p), what is the posterior?</span>
<span class="pl-c"># (i.e., the mean number of cases where it rain, r == 1)</span>
<span class="pl-smi">data_interest</span> %<span class="pl-k">&gt;</span>% summarize(<span class="pl-v">posterior</span> <span class="pl-k">=</span> round(mean(<span class="pl-smi">r</span>), <span class="pl-c1">3</span>)) %<span class="pl-k">&gt;</span>% 
  mutate(<span class="pl-v">posterior_theoretical</span> <span class="pl-k">=</span> round(<span class="pl-c1">8</span><span class="pl-k">*</span><span class="pl-smi">p</span> <span class="pl-k">/</span> (<span class="pl-c1">1</span> <span class="pl-k">+</span> <span class="pl-c1">7</span><span class="pl-k">*</span><span class="pl-smi">p</span>), <span class="pl-c1">3</span>)) %<span class="pl-k">&gt;</span>% 
  rename(<span class="pl-v">prior</span> <span class="pl-k">=</span> <span class="pl-smi">p</span>) %<span class="pl-k">&gt;</span>% print(<span class="pl-v">n</span> <span class="pl-k">=</span> <span class="pl-c1">Inf</span>)</pre></div>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">Source</span><span class="pl-k">:</span> <span class="pl-smi">local</span> <span class="pl-smi">data</span> <span class="pl-smi">frame</span> [<span class="pl-c1">21</span> <span class="pl-smi">x</span> <span class="pl-c1">3</span>]

   <span class="pl-smi">prior</span> <span class="pl-smi">posterior</span> <span class="pl-smi">posterior_theoretical</span>
   <span class="pl-k">&lt;</span><span class="pl-smi">dbl</span><span class="pl-k">&gt;</span>     <span class="pl-k">&lt;</span><span class="pl-smi">dbl</span><span class="pl-k">&gt;</span>                 <span class="pl-k">&lt;</span><span class="pl-smi">dbl</span><span class="pl-k">&gt;</span>
<span class="pl-c1">1</span>   <span class="pl-c1">0.00</span>     <span class="pl-c1">0.000</span>                 <span class="pl-c1">0.000</span>
<span class="pl-c1">2</span>   <span class="pl-c1">0.05</span>     <span class="pl-c1">0.279</span>                 <span class="pl-c1">0.296</span>
<span class="pl-c1">3</span>   <span class="pl-c1">0.10</span>     <span class="pl-c1">0.498</span>                 <span class="pl-c1">0.471</span>
<span class="pl-c1">4</span>   <span class="pl-c1">0.15</span>     <span class="pl-c1">0.587</span>                 <span class="pl-c1">0.585</span>
<span class="pl-c1">5</span>   <span class="pl-c1">0.20</span>     <span class="pl-c1">0.643</span>                 <span class="pl-c1">0.667</span>
<span class="pl-c1">6</span>   <span class="pl-c1">0.25</span>     <span class="pl-c1">0.705</span>                 <span class="pl-c1">0.727</span>
<span class="pl-c1">7</span>   <span class="pl-c1">0.30</span>     <span class="pl-c1">0.778</span>                 <span class="pl-c1">0.774</span>
<span class="pl-c1">8</span>   <span class="pl-c1">0.35</span>     <span class="pl-c1">0.814</span>                 <span class="pl-c1">0.812</span>
<span class="pl-c1">9</span>   <span class="pl-c1">0.40</span>     <span class="pl-c1">0.845</span>                 <span class="pl-c1">0.842</span>
<span class="pl-c1">10</span>  <span class="pl-c1">0.45</span>     <span class="pl-c1">0.850</span>                 <span class="pl-c1">0.867</span>
<span class="pl-c1">11</span>  <span class="pl-c1">0.50</span>     <span class="pl-c1">0.900</span>                 <span class="pl-c1">0.889</span>
<span class="pl-c1">12</span>  <span class="pl-c1">0.55</span>     <span class="pl-c1">0.903</span>                 <span class="pl-c1">0.907</span>
<span class="pl-c1">13</span>  <span class="pl-c1">0.60</span>     <span class="pl-c1">0.928</span>                 <span class="pl-c1">0.923</span>
<span class="pl-c1">14</span>  <span class="pl-c1">0.65</span>     <span class="pl-c1">0.949</span>                 <span class="pl-c1">0.937</span>
<span class="pl-c1">15</span>  <span class="pl-c1">0.70</span>     <span class="pl-c1">0.933</span>                 <span class="pl-c1">0.949</span>
<span class="pl-c1">16</span>  <span class="pl-c1">0.75</span>     <span class="pl-c1">0.952</span>                 <span class="pl-c1">0.960</span>
<span class="pl-c1">17</span>  <span class="pl-c1">0.80</span>     <span class="pl-c1">0.974</span>                 <span class="pl-c1">0.970</span>
<span class="pl-c1">18</span>  <span class="pl-c1">0.85</span>     <span class="pl-c1">0.977</span>                 <span class="pl-c1">0.978</span>
<span class="pl-c1">19</span>  <span class="pl-c1">0.90</span>     <span class="pl-c1">0.986</span>                 <span class="pl-c1">0.986</span>
<span class="pl-c1">20</span>  <span class="pl-c1">0.95</span>     <span class="pl-c1">0.995</span>                 <span class="pl-c1">0.993</span>
<span class="pl-c1">21</span>  <span class="pl-c1">1.00</span>     <span class="pl-c1">1.000</span>                 <span class="pl-c1">1.000</span></pre></div>

<p>Now let's consider a more generic case, where not only $$p$$, but also the number of friends, $$N$$, and the probability that any of them tells you the truth, $$q$$, are not fixed. This analysis will give us the <em>morality</em> of this problem, which could be "Always trust your friends (especially the more you have!), provided that they tell the truth more often than not" :)</p>

<p>Without loss of generality, let's assume that $$q$$ is a positive rational number, and hence can be written as $$\frac{a}{b}$$, where $$a,b \in \mathbb{N}$$. We want to focus on the case where our friends are more likely to tell the truth, so the following conditions must hold:</p>

<p>$$q \leq 1 \Rightarrow b \geq a$$</p>

<p>$$q \geq \frac{1}{2} \Rightarrow \frac{b}{a} \leq 2 \Rightarrow \frac{b}{a} - 1 \leq 1$$</p>

<p>We can write the posterior probability that we want to calculate as:</p>

<p>$$\begin{aligned}\Pr\left(H \mid E\right) &amp; = \frac{\left(\frac{a}{b}\right)^N \cdot p}{\left(\frac{a}{b}\right)^N \cdot p + \left(1 - \frac{a}{b}\right)^N \cdot (1 - p)} \ 
&amp; = \frac{a^N \cdot p}{a^N \cdot p + (b - a)^N \cdot (1-p)} \
&amp;  = \frac{1}{1 + \left(\frac{b}{a} - 1\right)^N \cdot \frac{1-p}{p}} \
\end{aligned}$$</p>

<p>Since $$\frac{b}{a} - 1 \leq 1$$, the limit of the posterior probability as $$N$$ approaches infinity is $$1$$, regardless of the value of $$p$$.</p>

<p>I.e., if a sufficiently large number of friends tell you that it rains in the desert, and the chances that each one of them is messing with you are less than 1/2, bring an umbrella with you. For $$N = 10$$ (and $$q = 2/3$$), the posterior is greater than $$0.9$$ for a prior as low as $$0.009$$.</p>

<p>Let's finish by plotting the posterior against the prior for a few possible values of $$q$$ and $$N$$:</p>

<div class="highlight highlight-source-r"><pre><span class="pl-en">posterior_prob</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(<span class="pl-smi">q</span>, <span class="pl-smi">N</span>, <span class="pl-smi">p</span>) {
  <span class="pl-smi">q</span><span class="pl-k">^</span><span class="pl-smi">N</span> <span class="pl-k">*</span> <span class="pl-smi">p</span> <span class="pl-k">/</span> (<span class="pl-smi">q</span><span class="pl-k">^</span><span class="pl-smi">N</span> <span class="pl-k">*</span> <span class="pl-smi">p</span> <span class="pl-k">+</span> (<span class="pl-c1">1</span> <span class="pl-k">-</span> <span class="pl-smi">q</span>)<span class="pl-k">^</span><span class="pl-smi">N</span> <span class="pl-k">*</span> (<span class="pl-c1">1</span><span class="pl-k">-</span><span class="pl-smi">p</span>))
}
<span class="pl-smi">p</span> <span class="pl-k">&lt;-</span> seq(<span class="pl-c1">0</span>, <span class="pl-c1">1</span>,  <span class="pl-c1">0.025</span>)
<span class="pl-smi">df</span> <span class="pl-k">&lt;-</span> <span class="pl-k">data.frame</span>(<span class="pl-v">Prior</span> <span class="pl-k">=</span> rep(<span class="pl-smi">p</span>, <span class="pl-v">each</span> <span class="pl-k">=</span> <span class="pl-c1">24</span>), 
                 <span class="pl-v">N</span> <span class="pl-k">=</span> rep(c(<span class="pl-c1">0</span><span class="pl-k">:</span><span class="pl-c1">3</span>, <span class="pl-c1">5</span>, <span class="pl-c1">10</span>), <span class="pl-v">each</span> <span class="pl-k">=</span> <span class="pl-c1">4</span>), 
                 <span class="pl-v">q</span> <span class="pl-k">=</span> c(<span class="pl-c1">0.51</span>, <span class="pl-c1">2</span><span class="pl-k">/</span><span class="pl-c1">3</span>, <span class="pl-c1">3</span><span class="pl-k">/</span><span class="pl-c1">4</span>, <span class="pl-c1">4</span><span class="pl-k">/</span><span class="pl-c1">5</span>)) %<span class="pl-k">&gt;</span>% 
  mutate(<span class="pl-v">Posterior</span> <span class="pl-k">=</span> posterior_prob(<span class="pl-smi">q</span>, <span class="pl-smi">N</span>, <span class="pl-smi">Prior</span>), 
         <span class="pl-v">Friends</span> <span class="pl-k">=</span> as.factor(<span class="pl-smi">N</span>), 
         <span class="pl-v">Q</span> <span class="pl-k">=</span> <span class="pl-k">factor</span>(as.character(fractions(<span class="pl-smi">q</span>)), 
                    <span class="pl-v">levels</span> <span class="pl-k">=</span> as.character(fractions(unique(<span class="pl-smi">q</span>)))))
library(<span class="pl-smi">ggplot2</span>)
library(<span class="pl-smi">MASS</span>)
ggplot(<span class="pl-v">data</span> <span class="pl-k">=</span> <span class="pl-smi">df</span>, aes(<span class="pl-v">x</span> <span class="pl-k">=</span> <span class="pl-smi">Prior</span>, <span class="pl-v">y</span> <span class="pl-k">=</span> <span class="pl-smi">Posterior</span>, <span class="pl-v">colour</span> <span class="pl-k">=</span> <span class="pl-smi">Friends</span>)) <span class="pl-k">+</span> 
  geom_line() <span class="pl-k">+</span> 
  labs(<span class="pl-v">title</span> <span class="pl-k">=</span> paste(<span class="pl-s"><span class="pl-pds">'</span>Posterior vs. Prior for different<span class="pl-cce">\n</span>values of<span class="pl-pds">'</span></span>, 
                     <span class="pl-s"><span class="pl-pds">'</span>the (individual) Likelihood<span class="pl-pds">'</span></span>)) <span class="pl-k">+</span> 
  facet_wrap( <span class="pl-k">~</span> <span class="pl-smi">Q</span>, <span class="pl-v">nrow</span> <span class="pl-k">=</span> <span class="pl-c1">2</span>) <span class="pl-k">+</span> coord_fixed()
options(<span class="pl-v">repr.plot.width</span> <span class="pl-k">=</span> <span class="pl-c1">8</span>, <span class="pl-v">repr.plot.height</span> <span class="pl-k">=</span> <span class="pl-c1">8</span>)</pre></div>

<p><img src="/output_8_0.png" alt="svg">{:class="img-responsive"}</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/juanjocarin/Bimbo">Bimbo</a> is maintained by <a href="https://github.com/juanjocarin">juanjocarin</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>